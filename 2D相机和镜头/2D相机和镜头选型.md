# 2D相机和镜头选型

## 选型方法
1. 首先，需要考虑决定检测精度和视野大小的分辨率。
2. 需考虑帧率，相机帧率需要大于等于检测速度。
3. 再次是曝光方式，全局曝光还是卷帘曝光，准确识别一般需要选择全局曝光。
4. 最后则是其余参数的选择，如CCD或CMOS、网口或USB等。

----------------------------------------------
# 1. 相机


## CCD相机和CMOS相机
图像处理器芯片可分为CCD相机和CMOS相机，CMOS相机正成为主流。随着CMOS传感器在消费电子行业的大量应用，CMOS传感器在架构设计和工艺保障上已经明显改善，同时CMOS具有集成度高、成本低、体积小等优势，目前在众多应用场景中正逐步取代CCD传感器。
- CCD是电荷耦合器件的简称。CCD是各个感光元器件信号统一放大，噪声较小。
- CMOS是互补金属氧化物半导体的简称。CMOS则是单独放大，图像有大量噪声，图像品质低于CCD传感器。



## 传输接口
- Camera Link接口传输速度最快，专门为工业相机设计，可以通过接口为工业相机供电，而不需要外接电源线，但需要单独购买图像采集卡，因为一般电脑不自带Camera Link接口。
- USB3.0传输速度第二，一般电脑都自带该接口，可以不单独购买图像采集卡，并且也可以通过USB3.0供电。
- GigE接口，就是电脑千兆网口，传输速度排在第三位，一般电脑自带一个千兆网口，如需同时连接多个相机，需要单独购买图像采集卡，GigE接口可以通过Poe供电。

**速度方面**
基本上，USB接口快于网口，但稳定性不如，线缆长度一般也较短。
USB接口分为2.0和3.0，一般是5000MB的。
网口一般是千兆网口，更好的是万兆网口，也存在5000网口（但比较少）。

**稳定性方面**
USB接口容易脱离，而网口有卡扣。
USB接口是供电和数据传输同一个口，而网口只是传输数据，会有配套的其他接口供电。

**线长方面**
USB线较短，3~5m就是极限了。当然，现在也有十几米长的USB线，但该种USB为了防止电磁之类的干扰，会多增加保护层，所以很贵。
网口可以很长，几十米都可以。


# 相关参数
## 视角
一般选小一点的，这样视场角比较小，实际像素分辨率会更紧凑
Realsense是60°的视角
visual servo不一样，分辨率太大的话帧率和处理速度就慢了。追求帧率的话就不可能有很高的分辨率了

## 靶面大小
一般而言，靶面越大，分辨率越大。
常见的靶面大小包括1.1''、1.0''、2/3''
靶面尺寸指的是相机传感器尺寸，一般靶面尺寸、分辨率和像素大小的选择是需要综合考虑的。靶面尺寸主要根据所要拍摄物体的大小选择，物体尺寸越大，一般要选靶面尺寸较大的，如果靶面尺寸选择的过小，那么会导致放大倍率过大，物体分辨精度减小。

工业相机的靶面大小，如果要求不是太严格，可以直接按照公式计算。
通常厂家会告诉你多少寸的传感器，那么就可以直接使用16mm*X’的传感器得到工业相机的图像传感器的靶面对角线长度。之所以使用16mm代表1寸，而不是使用25mm，这个是有历史原因的，可以查看相关历史文档。这样1/2’传感器对角线则为8mm，按照一般的传感器的长宽比为4：3的话，那么就对应勾股定理，1/2’的传感器长宽分辨率为6.4mm、4.8mm。
其实厂家也会告诉你像元的大小以及分辨率，同样可以计算传感器的靶面大小。如某相机的分辨率为2588*1940的500万像素，像元大小为2.2um，则其传感器的尺寸为2588*2.2=5694um=5.694mm，宽方向为1940*2.2=4268um=4.268mm，即为1/.25’的传感器。当然现在的传感器像素一般是正方形的像素，如果是矩形的像素，则分别使用像素长*分辨率的长、像素宽*分辨率的宽即可。按照后面这种像素*分辨率计算得到的靶面大小是肯定准确的。
而分辨率和像素大小是根据被拍摄物体要求分辨的精度确定，例如待拍摄物体长80mm，宽60mm，分辨率要求0.1mm，那么要求图像分辨率（一般图像分辨率指图像大小，而不是像素尺寸）至少是800×600，而像素尺寸（对应物体分辨率）应该综合考虑物体分辨率和放大倍率。

经验，不要选太大的靶面（太大的靶面就是有黑边），选择合适就行。

## 畸变
分为径向畸变，切向畸变
畸变不只是镜头的，而是相机和镜头一起的。也就是说，同一个镜头，更换不同相机，由于镜头和相机的安装时误差，导致畸变有变化。所以，这一次标定了镜头的畸变，下一次仍然需要再次标定。
径向畸变和切向畸变模型中一般一共有5个畸变参数，在Opencv中他们被排列成一个5*1的矩阵。

径向畸变就是沿着透镜半径方向分布的畸变，产生原因是光线在原理透镜中心的地方比靠近中心的地方更加弯曲，这种畸变在普通廉价的镜头中表现更加明显，径向畸变主要包括桶形畸变和枕形畸变两种。
切向畸变是由于透镜本身与相机传感器平面（成像平面）或图像平面不平行而产生的，这种情况多是由于透镜被粘贴到镜头模组上的安装偏差导致。


## 帧率
如需拍摄运动状态下的物体，那么就需要考虑相机帧速率是否匹配物体运动速度。帧速率是指相机每秒能够拍摄多少帧（张）图片，而能否匹配物体运动速度，还需要综合考虑相机曝光时间。
帧率不够，则曝光不够，则有拖影。
调小曝光，光线亮一点。
调小曝光，才能保证位置正确，否则有拖影。

## 信噪比
数值越大越好。

## 动态范围
能适应的光照变化大小。数值越大越好。


----------------------------------------------
# 2. 镜头

### 镜头类型
主要分为普通镜头和远心镜头。
**远心镜头**
依据其独特的光学特性：高分辨率、超宽景深、超低畸变以及独有的平行光设计等，给机器视觉精密检测带来质的飞跃。
远心镜头是为纠正传统镜头的视差而设计的特殊镜头，它不仅具有镜头本质特性，而且具有放大倍数恒定、无视差等特点，常常应用于微小物体测量；普通镜头只具有一般的光学成像，放大倍率经常变化，有视差，一般只适用于大物体成像。在价格方面，远心镜头远远高于普通镜头。 
远心镜头是为纠正传统镜头的视差而特殊设计的镜头，它可以在一定的物距范围内，使得到的图像放大倍率不会随物距的变化而变化。
远心镜头独有的平行光路设计能纠正传统工业镜头视差，可在一定物距范围内，使得到的图像放大倍率不会变化，具有高分辨率、超宽景深、超低畸变的特性，在精密检测领域备受欢迎。

###工作距离
指镜头与物体的距离，根据实际情况确定，一般普通镜头的工作距离可以调节，最小工作距离一般为200mm左右，而远心镜头的工作距离不可调节，一般100mm左右。

### 焦距
在放大倍率和工作距离确定的情况下，焦距可以通过放大倍率×工作距离得出。一般镜头的焦距为12mm、16mm、25mm、35mm等。

### 光圈
用F表示，以镜头焦距f和通光孔径D的比值来衡量。孔径越大，更多的光线进行相机、亮度也越大。一般镜头上都标有最大F值，例如：8mm/F1.4代表焦距8mm，最大孔径D为5.7mm，F值越小，光圈越大，F值越大，光圈越小。


### 景深
景深是指在被摄物体聚焦清楚后，在物体前后一定距离内，其影像仍然清晰的范围。

对焦点前（靠近相机）、后一定距离内的景物的成像都可以是清晰的，这个前后范围的总和，就叫做景深。
与图像层面的大小变化。
通俗点来理解，例如当你在拍摄有纵深的场景时，比如说街道、排酒瓶，当对焦点选择在画面中间时，前面的景物和后面的景物有可能会出现模糊，而有时候却又是清晰的，这个范围就是景深的范围，我们要明白如何控制这个范围，让该清晰的时候清晰，该模糊的时候模糊。


景深随镜头的光圈值、焦距、拍摄距离而变化，光圈越大，景深越小（浅），光圈越小，景深越大（深）。焦距越长，景深越小，焦距越短，景深越大。
距离拍摄物体越近时，景深越小，拍摄距离约远，景深越大。
一般远心镜头的景深要高于普通镜头。


### FOV（视场角）的计算
a为水平视场角
b为垂直视场角


公式1：（小孔成像的这一边）
a = 2 * arctan(w / (2 * L))
其中，a:水平视场角；w:水平图像尺寸；L:焦距
FOV (V or H) = WD x 感应尺寸 (V or H) / f

公式2：
a = 2 * arctan(w / (2 * L))
其中，a:水平视场角；w:实际的水平范围；L:镜头离平台的距离
----------------------------------------------
# 3. 其他
## 模组
既带相机又带镜头，opencv相机就是最典型的模组，一般不会由于工业界（工业界精度要求很高），而是用于监控之类的。


## 相机本身


## 板级相机
没有外壳的相机，无镜头

## 智能相机
就是带SDK的相机，SDK中集成有检测、分类等等算法。


## 液态镜头
液态镜头是一种使用一种或多种液体制成的无机械连接的光学元件，可以通过外部控制改变光学元件的内部参数，有着传统光学透镜无法比拟的性能。简单来说就是透镜的介质由玻璃变为液体。更准确地来说就是一种动态调整透镜折射率或通过改变其自身曲率来改变焦距的新型光学元件，由于没有移动部件，故被称为固态AF系统。
可以认为是一个附加模块，使用时必须配合正常的镜头。
自动对焦技术以与人眼相同的方式调整镜头形变和弯曲解决了这个问题，因此无需任何机械组件即可进行对焦。这个聚焦调整也可通过软件完成，因此不再需要操作员在现场或生产线上手动调节镜头。
对于光学镜头的不确定性，纯电路可量化的液态镜头对焦更加准确，光学数据更精准。随着物体到相机距离的变化，镜头会自动逐帧调整焦点。重新调焦仅需2到3毫秒，每次都保证照片的清晰度。

# 防护等级
工业场景需要抗干扰

----------------------------------------------
# 4. 调整相机或镜头的参数

## 物理参数应该优先调整
调整相机参数分为物理参数和图像参数。优先调整物理参数，包括
- 镜头的焦距。
- 镜头的光圈。
- 镜头与相机之间的连接螺环也是可以调节的，不过一般只需要拧紧即可。

靠镜头近的是调焦距，靠镜头远的是调光圈（一般将光圈调到最大，然后通过曝光调节亮度）。调完之后一定要拧紧螺丝。

## 调整白平衡white balance
调整白平衡时，选择once模式，然后将一张白纸放置在相机视野内并充满整个视野，点击白平衡可以得到白平衡的模板。当然，接下来，还可以继续设置某个通道的值。
白平衡的原理就是记录下来视野为纯白色时的像素值（三通道RGB都记录），即3*W*H的模板图片，然后在实际使用时会减去该模板图片的像素值。
原理上也可以将阴影给过滤掉。

## gamma
对整体亮度的非线性调整

## gain
对单通道或者整体的亮度的线性调整

## black level
将低于该阈值的像素置为0

## 调节图像亮度
调节曝光来保证图像质量。调小曝光+增加光源亮度+加大gamma值：精度基本不变，可提高FPS。可提升空间不大（原先的曝光时间是8000）。
调节曝光
帧率不够，则曝光不够，则有拖影
调小曝光，光线亮一点。
调小曝光，才能保证位置正确，否则有拖影。

## 图像出现黑边
如果镜头的有效视野小于相机成像芯片（CMOS）的尺寸，就会出现黑边。

----------------------------------------------
# 5. 调整拍照环境
为了得到更好的图像，常见的方式包括
- 修改相机配置
- 更换背景
- 调整光源
- 调整相机与物料的距离





----------------------------------------------
# 6.1 2D相机商家
欧美品牌在高分辨率、高端工业相机领域仍占据主导地位。
国内厂商主打性价比优势，对中国市场应用进行针对性开发，以占取有利切入点。

## 国内公司
中维奥柯科技有限公司（http://www.zwlrcp.cn/product/5/#c_portalResProduct_list-16212250892358221-1），只是opencv相机（比工业相机的景深更大，更适合isual servo之类的应用）
凌云光
大华
海康威视


2021年中国机器视觉销售额排名前五分别是凌云光、大恒集团、奥普特、宝视纳和华睿科技。在细分领域，2021年本土领军企业凌云光在消费电子领域市场份额已达22.4%，位列国内第三，仅次于康耐视和基恩士。此外，公司在印刷包装领域已经占据21.1%的行业第一份额。
国内竞争格局相对分散，集中度下降，国产厂商加速追赶。机器视觉的下游应用呈现碎片化和定制化，行业的集中度较低，单个企业也呈现多型号、小批量的业务结构特征。根据机器视觉产业联盟（CMVU）2021年度企业调查结果，机器视觉的市场集中度呈下降趋势。2019-2021年，销售额CR5从37.7%下降至31.3%，销售额CR10从51.3%下降至43.1%。考虑到较成熟的国外市场相比，我国机器视觉行业仍处于生命周期的早期，市场远未饱和，我们认为短期内中国机器视觉市场规模会随自动化水平的提高而增加，行业集中度将保持较为分散。

## 国外公司
基恩士（Keyence，日本）
康耐视（Cognex，美国）
巴斯勒（Basler，德国）


# 6.2 镜头商家
大部分都是日本的厂商。
Phenix(凤凰光学)：给海康代工的商家。相同的镜头，海康比Phenix贵很多。
联合光科
Computar（日本）


